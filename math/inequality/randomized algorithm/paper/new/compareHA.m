clear
clc
debug = 0;
%% 产生问题矩阵
m = 10000;
n = 1000;
A = 2 * rand(m , n)-1;
b = 2 * rand(m , 1)-1;

x0 = zeros(n , 1);
tol=1e-50-1;
fprintf('%s & %d & %d tol=%g\n','矩阵维数', m, n, tol);
%% 基于IFM的算法找到一个解
maxit_LSQR = 3;
r = b - A * x0;
r(r<0) = 0;
norm_r0 = norm(r);
norm_g0 = norm(A'*r);
fprintf('%s & %g & %g \n','最开始的目标函数和梯度', norm_r0, norm_g0);
% [x_exact, ~, ~, ~, ~] = IFM(A, b, x0,10, maxit_LSQR , 1e-10,[],debug);
% r = b - A * x_exact;
% r(r<0) = 0;
% norm_rexact = norm(r);
% norm_gexact = norm(A'*r);
% fprintf('%s & %g & %g \n','IFM解的目标函数值和梯度  ', norm_rexact, norm_gexact);
 x_exact=[];
%% 参数的设定
nf=3;
maxIter = 100;
steplengthOrk=0;
for i=1:5
       str = ['D','U','C','R','P'];
               type = str(i);
tol=1e-11;
t=clock;
[x_HA,flag,iter_HA,error_k,indexsm] = hybridA(A,b,x0,maxIter,nf,[type,'HA'],tol,x_exact,debug);
tf_HA=etime(clock,t);
r = b - A * x_HA;
r(r<0) = 0;
r_HA = norm(r);
g_HA = norm(A'*r);
fprintf('& %s & %g & %g & (%d,%d) & %g \\\\\n',[type,'HA'], r_HA, g_HA,iter_HA,indexsm,tf_HA);
end
%% GuassSeidel
maxit_Rand =20000;
tol=1e-12-1;
t=clock;
 [x_GS,iter_GS,error_GS,xA_GS,index_GS] = GuassSeidelNE(A, b, x0,2.0,maxit_Rand*2,tol,x_exact,debug);
tf_GS=etime(clock,t);
r = b - A * x_GS;
r(r<0) = 0;
r_GS = norm(r);
g_GS = norm(A'*r);
fprintf('& %s & %g & %g & %d & %g \\\\\n', 'CCD', r_GS, g_GS, iter_GS, tf_GS);


%% simpleGuassSeidel
% maxit_Rand =1000000;
t=clock;
[x_GS,iter_SGS,error_SGS,xA_GS,index_GS] = simpleGuassSeidelNE(A, b, x0,2.0,maxit_Rand*4,tol,x_exact,debug);
tf_GS=etime(clock,t);
r = b - A * x_GS;
r(r<0) = 0;
r_GS = norm(r);
g_GS = norm(A'*r);
fprintf('& %s & %g & %g & %d & %g \\\\\n', 'UCD', r_GS, g_GS, iter_SGS, tf_GS);

%% randGuassSeidel
% maxit_Rand =630000;
t=clock;
[x_GS,iter_RGS,error_RGS,xA_GS,index_GS] = randGuassSeidelNE(A, b, x0,2.0,maxit_Rand*4,tol,x_exact,debug);
tf_GS=etime(clock,t);
r = b - A * x_GS;
r(r<0) = 0;
r_GS = norm(r);
g_GS = norm(A'*r);
fprintf('& %s & %g & %g & %d & %g \\\\\n', 'RCD', r_GS, g_GS, iter_RGS, tf_GS);

% & DHA & 22.7472 & 6.75505e-13 & (45,0) & 2.601 \\
% & UHA & 22.7472 & 3.22888e-13 & (3,3) & 2.948 \\
% & CHA & 22.7472 & 3.37942e-13 & (9,1) & 1.437 \\
% & RHA & 22.7472 & 3.10867e-13 & (23,1) & 1.872 \\
% & PHA & 22.7472 & 3.32901e-13 & (8,1) & 1.402 \\
% & CCD & 22.7472 & 1.97542e-12 & 20000 & 0.461 \\
% & UCD & 22.7472 & 3.49618e-12 & 50000 & 1.19 \\
% & RCD & 22.7472 & 3.22791e-12 & 50000 & 1.255 \\

% 矩阵维数 & 500 & 50 tol=-1
% 最开始的目标函数和梯度 & 9.48765 & 26.1008 
% & DHA & 9.00499 & 7.02938e-14 & (36,0) & 0.019 \\
% & UHA & 9.00499 & 1.99235e-14 & (2,2) & 0.008 \\
% & CHA & 9.00499 & 1.69799e-14 & (36,1) & 0.015 \\
% & RHA & 9.00499 & 1.6933e-14 & (5,1) & 0.007 \\
% & PHA & 9.00499 & 1.81286e-14 & (2,1) & 0.008 \\
% & CCD & 9.00499 & 1.49994e-13 & 4000 & 0.013 \\
% & UCD & 9.00499 & 2.88041e-13 & 10000 & 0.05 \\
% & RCD & 9.00499 & 2.88945e-13 & 10000 & 0.039 \\


% 矩阵维数 & 6000 & 600 tol=-1
% 最开始的目标函数和梯度 & 31.4302 & 453.789 
% & DHA & 27.8561 & 8.90212e-13 & (45,0) & 5.509 \\
% & UHA & 27.8561 & 5.80304e-13 & (3,3) & 10.119 \\
% & CHA & 27.8561 & 5.95211e-13 & (9,1) & 2.866 \\
% & RHA & 27.8561 & 5.74519e-13 & (23,1) & 4.164 \\
% & PHA & 27.8561 & 5.95211e-13 & (9,1) & 3.162 \\
% & CCD & 27.8561 & 5.25391e-12 & 40000 & 1.177 \\
% & UCD & 27.8561 & 9.94412e-12 & 100000 & 3.098 \\
% & RCD & 27.8561 & 1.00268e-11 & 100000 & 3.272 \\


% 矩阵维数 & 6000 & 600 tol=-1
% 最开始的目标函数和梯度 & 31.6854 & 474.609 
% & DHA & 28.1428 & 6.41423e-13 & (43,0) & 5.307 \\
% & UHA & 28.1428 & 5.75861e-13 & (3,3) & 8.43 \\
% & CHA & 28.1428 & 5.60076e-13 & (15,1) & 3.415 \\
% & RHA & 28.1428 & 5.87162e-13 & (21,1) & 3.886 \\
% & PHA & 28.1428 & 5.81983e-13 & (6,1) & 2.809 \\
% & CCD & 28.1428 & 3.56615e-12 & 30000 & 0.897 \\
% & UCD & 28.1428 & 6.01707e-12 & 75000 & 2.368 \\
% & RCD & 28.1428 & 6.18236e-12 & 75000 & 2.507 \\

% 矩阵维数 & 6000 & 600 tol=-1
% 最开始的目标函数和梯度 & 31.3731 & 453.676 
% & DHA & 27.9027 & 7.87682e-13 & (46,0) & 5.626 \\
% & UHA & 27.9027 & 5.18006e-13 & (3,3) & 9.536 \\
% & CHA & 27.9027 & 5.85159e-13 & (10,1) & 3.116 \\
% & RHA & 27.9027 & 5.56831e-13 & (23,1) & 4.094 \\
% & PHA & 27.9027 & 5.74794e-13 & (8,1) & 2.942 \\
% & CCD & 27.9027 & 3.40911e-12 & 30000 & 0.898 \\
% & UCD & 27.9027 & 5.34137e-12 & 60000 & 1.879 \\
% & RCD & 27.9027 & 5.44283e-12 & 60000 & 1.975 \\
% 
% 矩阵维数 & 10000 & 1000 tol=-1
% 最开始的目标函数和梯度 & 40.3206 & 708.699 
% & DHA & 36.3183 & 6.34649e-12 & (42,0) & 17.312 \\
% & UHA & 36.3183 & 1.28998e-12 & (3,3) & 36.916 \\
% & CHA & 36.3183 & 1.23679e-12 & (19,2) & 15.795 \\
% & RHA & 36.3183 & 1.31249e-12 & (23,1) & 14.961 \\
% & PHA & 36.3183 & 1.27857e-12 & (8,2) & 13.587 \\
% & CCD & 36.3183 & 7.05229e-09 & 30000 & 1.319 \\
% & UCD & 36.3183 & 3.77652e-07 & 60000 & 2.65 \\
% & RCD & 36.3183 & 4.71277e-07 & 60000 & 2.817 \\

% 矩阵维数 & 10000 & 1000 tol=-1
% 最开始的目标函数和梯度 & 40.6492 & 725.173 
% & DHA & 36.4281 & 9.00671e-12 & (41,0) & 16.668 \\
% & UHA & 36.4281 & 1.2275e-12 & (3,3) & 39.981 \\
% & CHA & 36.4281 & 1.29581e-12 & (11,1) & 11.831 \\
% & RHA & 36.4281 & 1.21063e-12 & (23,1) & 14.563 \\
% & PHA & 36.4281 & 1.29597e-12 & (9,1) & 11.924 \\
% & CCD & 36.4281 & 1.0207e-11 & 60000 & 2.59 \\
% & UCD & 36.4281 & 1.1723e-11 & 120000 & 5.299 \\
% & RCD & 36.4281 & 1.30059e-11 & 120000 & 5.637 \\
% 矩阵维数 & 10000 & 1000 tol=-1
% 最开始的目标函数和梯度 & 40.9667 & 744.682 
% & DHA & 36.6258 & 5.08061e-12 & (43,0) & 17.383 \\
% & UHA & 36.6258 & 1.25253e-12 & (3,3) & 38.202 \\
% & CHA & 36.6258 & 1.27962e-12 & (8,1) & 11.368 \\
% & RHA & 36.6258 & 1.31327e-12 & (23,1) & 14.933 \\
% & PHA & 36.6258 & 1.27962e-12 & (8,1) & 11.713 \\
% & CCD & 36.6258 & 2.09475e-11 & 100000 & 4.375 \\
% & UCD & 36.6258 & 2.9149e-11 & 200000 & 8.912 \\
% & RCD & 36.6258 & 2.91891e-11 & 200000 & 9.469 \\
% 矩阵维数 & 10000 & 1000 tol=-1
% 最开始的目标函数和梯度 & 40.6236 & 719.774 
% & DHA & 36.5539 & 7.03771e-12 & (42,0) & 16.687 \\
% & UHA & 36.5539 & 1.25308e-12 & (3,3) & 35.636 \\
% & CHA & 36.5539 & 1.28355e-12 & (11,1) & 12.329 \\
% & RHA & 36.5539 & 1.2448e-12 & (25,1) & 15.318 \\
% & PHA & 36.5539 & 1.24217e-12 & (7,1) & 11.455 \\
% & CCD & 36.5539 & 1.51041e-05 & 20000 & 0.906 \\
% & UCD & 36.5539 & 0.000451746 & 40000 & 1.815 \\
% & RCD & 36.5539 & 0.00050659 & 40000 & 1.931 \\

% 矩阵维数 & 10000 & 1000 tol=-1
% 最开始的目标函数和梯度 & 40.7333 & 747.997 
% & DHA & 36.2603 & 6.01211e-12 & (43,0) & 17.272 \\
% & UHA & 36.2603 & 1.2236e-12 & (3,3) & 38.849 \\
% & CHA & 36.2603 & 1.29484e-12 & (8,1) & 11.319 \\
% & RHA & 36.2603 & 1.24638e-12 & (24,1) & 15.151 \\
% & PHA & 36.2603 & 1.22583e-12 & (7,1) & 11.374 \\
% & CCD & 36.2603 & 2.68629e-11 & 40000 & 1.9 \\
% & UCD & 36.2603 & 2.63679e-09 & 80000 & 3.704 \\
% & RCD & 36.2603 & 2.77958e-09 & 80000 & 3.811 \\